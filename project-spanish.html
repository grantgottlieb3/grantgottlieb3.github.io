<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spanish Immersion — Conversational Web App | Grant Gottlieb</title>
  <meta name="description" content="Clean, approachable practice scenes for Spanish conversation, with customizable language, city, and CEFR level." />
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" href="assets/headshot-placeholder.svg" />

  <!-- Page-only tweaks (keeps site brand) -->
  <style>
    /* Links are plain unless buttons */
    a { text-decoration: none; color: inherit; }
    a:hover, a:focus { opacity: .95; }
    a.button { color: #fff !important; }
    .button.ghost { color: var(--text) !important; background: transparent; border: 1px solid var(--border); }
    .button.ghost:hover { background: var(--accent-2); }

    /* Remove donut logos only on this page */
    .item .logo { display: none !important; }

    /* Hero: title only, no subtitle/actions/headshot */
    .hero { grid-template-columns: 1fr !important; padding-bottom: 24px; }
    .hero .title { margin-bottom: 0; }
    .hero .headshot { display: none !important; }

    /* Controls */
    .controls { display: grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 720px) { .controls { grid-template-columns: repeat(3, 1fr); } }
    .control { display: grid; gap: 6px; }
    .control label { font-size: 13px; color: var(--muted); }
    select, input[type="text"] {
      width: 100%; padding: 10px 12px; border-radius: 10px;
      border: 1px solid var(--border); background: var(--card); color: var(--text);
      font: inherit;
    }

    /* Tabs */
    .tabs { display: flex; gap: 8px; flex-wrap: wrap; }
    .tab-btn {
      border: 1px solid var(--border); background: var(--card);
      border-radius: 999px; padding: 8px 12px; cursor: pointer; font-weight: 600;
    }
    .tab-btn.active { background: var(--text); color: #fff; }

    .tab-panel { display: none; }
    .tab-panel.active { display: block; }

    /* Scene cards */
    .scene-card .content { padding: 16px; }
    .scene-card h4 { margin: 0 0 6px; font-size: 16px; }
    .scene-card p { margin: 0; color: var(--muted); }

    /* Custom scene input row */
    .custom-row { display: grid; grid-template-columns: 1fr auto; gap: 10px; margin: 8px 0 0; }

    /* Modal */
    .modal {
      position: fixed; inset: 0; display: none; place-items: center;
      background: rgba(0,0,0,.35); z-index: 1000; padding: 20px;
    }
    .modal.open { display: grid; }
    .modal .sheet {
      width: min(720px, 100%); background: var(--card); color: var(--text);
      border: 1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow);
      overflow: hidden;
    }
    .sheet header { display:flex; justify-content:space-between; align-items:center; padding:14px 16px; border-bottom:1px solid var(--border); }
    .sheet header h3 { margin:0; font-size:18px; }
    .sheet .body { padding: 14px 16px; display: grid; gap: 12px; }
    .sheet .row { display: grid; gap: 4px; }
    .sheet .row small { color: var(--muted); }
    .sheet footer { padding: 14px 16px; border-top: 1px solid var(--border); display:flex; gap:10px; justify-content:flex-end; flex-wrap: wrap; }

    /* Tiny helper for muted meta */
    .meta { color: var(--muted); font-size: 13px; }
  </style>
</head>
<body>
<header class="header">
  <div class="container nav">
    <div class="left"><a href="index.html" class="brand">Grant Gottlieb</a></div>
    <nav class="right"><a href="index.html#projects">← Back to Projects</a></nav>
  </div>
</header>

<main class="container">
  <!-- =============================== Hero (title only) =============================== -->
  <section class="hero" id="top">
    <div>
      <h1 class="title">Spanish Immersion — Conversational Web App</h1>
    </div>
  </section>

  <!-- =============================== Customization =============================== -->
  <section id="customization">
    <div class="section-title"><h2>Customization</h2><div class="line"></div></div>
    <article class="card item">
      <div>
        <div class="controls">
          <div class="control">
            <label for="langSel">Language</label>
            <select id="langSel">
              <option>Spanish</option>
              <option>English</option>
            </select>
          </div>

          <div class="control">
            <label for="citySel">City (Spain)</label>
            <select id="citySel">
              <option>Madrid</option>
              <option>Barcelona</option>
              <option>Valencia</option>
              <option>Sevilla</option>
              <option>Bilbao</option>
              <option>Málaga</option>
              <option>Granada</option>
              <option>Zaragoza</option>
              <option>Salamanca</option>
              <option>Córdoba</option>
              <option>San Sebastián</option>
              <option>Torrevieja</option>
            </select>
          </div>

          <div class="control">
            <label for="levelSel">CEFR Level</label>
            <select id="levelSel">
              <option>A1</option>
              <option>A2</option>
              <option selected>B1</option>
              <option>B2</option>
              <option>C1</option>
              <option>C2</option>
            </select>
          </div>
        </div>
        <div class="meta" style="margin-top:8px;">Choices persist in your browser for next visit.</div>
      </div>
    </article>
  </section>

  <!-- =============================== Scenes (Tabs) =============================== -->
  <section id="scenes">
    <div class="section-title"><h2>Scenes</h2><div class="line"></div></div>

    <div class="tabs" role="tablist" aria-label="Scene categories">
      <button class="tab-btn active" data-tab="travel" role="tab" aria-selected="true">Travel</button>
      <button class="tab-btn" data-tab="food" role="tab">Food</button>
      <button class="tab-btn" data-tab="daily" role="tab">Daily</button>
      <button class="tab-btn" data-tab="culture" role="tab">Culture</button>
      <button class="tab-btn" data-tab="social" role="tab">Social</button>
      <button class="tab-btn" data-tab="custom" role="tab">Custom</button>
    </div>

    <!-- Panels -->
    <div id="panel-travel" class="tab-panel active" role="tabpanel" aria-labelledby="travel">
      <div id="list-travel" class="grid"></div>
    </div>

    <div id="panel-food" class="tab-panel" role="tabpanel" aria-labelledby="food">
      <div id="list-food" class="grid"></div>
    </div>

    <div id="panel-daily" class="tab-panel" role="tabpanel" aria-labelledby="daily">
      <div id="list-daily" class="grid"></div>
    </div>

    <div id="panel-culture" class="tab-panel" role="tabpanel" aria-labelledby="culture">
      <div id="list-culture" class="grid"></div>
    </div>

    <div id="panel-social" class="tab-panel" role="tabpanel" aria-labelledby="social">
      <div id="list-social" class="grid"></div>
    </div>

    <div id="panel-custom" class="tab-panel" role="tabpanel" aria-labelledby="custom">
      <article class="card item">
        <div style="width:100%;">
          <h3 style="margin:0 0 6px;">Custom Scenario</h3>
          <p class="meta" style="margin: 0 0 10px;">Type a keyword (e.g., “pharmacy”, “football”, “job interview”) and generate a tailored practice scene.</p>
          <div class="custom-row">
            <input type="text" id="customKeyword" placeholder="Keyword or topic…" />
            <button class="button" id="addCustom">Generate</button>
          </div>
        </div>
      </article>
      <div id="list-custom" class="grid" style="margin-top:12px;"></div>
    </div>
  </section>
</main>

<footer class="container footer">
  <div>&copy; <span id="year"></span> Grant Gottlieb</div>
  <div>Built with clean HTML/CSS/JS.</div>
</footer>

<!-- =============================== Modal =============================== -->
<div class="modal" id="modal">
  <div class="sheet" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <header>
      <h3 id="modalTitle">Scenario Details</h3>
      <button class="button ghost" id="closeModal" aria-label="Close">Close</button>
    </header>
    <div class="body">
      <div class="row">
        <small>Who you’re talking to</small>
        <div id="modalRole"></div>
      </div>
      <div class="row">
        <small>Setting</small>
        <div id="modalSetting"></div>
      </div>
      <div class="row">
        <small>Key information</small>
        <div id="modalKey"></div>
      </div>
    </div>
    <footer>
      <button class="button ghost" id="copyPrompt">Copy Prompt</button>
      <button class="button" id="markComplete">Mark Complete</button>
    </footer>
  </div>
</div>

<script>
  // Year stamp
  (function(){ const y=document.getElementById('year'); if(y) y.textContent=new Date().getFullYear(); })();

  // ------------------------------------------------------------
  // State & persistence
  // ------------------------------------------------------------
  const STORE = {
    langKey: 'spanish_app_lang',
    cityKey: 'spanish_app_city',
    levelKey: 'spanish_app_level',
    listsKey: 'spanish_app_lists'
  };

  const langSel  = document.getElementById('langSel');
  const citySel  = document.getElementById('citySel');
  const levelSel = document.getElementById('levelSel');

  // Load persisted selections
  langSel.value  = localStorage.getItem(STORE.langKey)  || 'Spanish';
  citySel.value  = localStorage.getItem(STORE.cityKey)  || 'Madrid';
  levelSel.value = localStorage.getItem(STORE.levelKey) || 'B1';

  langSel.addEventListener('change', () => localStorage.setItem(STORE.langKey, langSel.value));
  citySel.addEventListener('change', () => localStorage.setItem(STORE.cityKey, citySel.value));
  levelSel.addEventListener('change', () => localStorage.setItem(STORE.levelKey, levelSel.value));

  // ------------------------------------------------------------
  // Data model for scenarios, per tab
  // ------------------------------------------------------------
  function initialScenario(tab) {
    const city = citySel.value;
    const map = {
      travel: {
        id: 'travel-1',
        title: 'Arrival & Passport Control',
        brief: `Essentials at ${city} airport: passport, luggage, and getting into the city.`,
        role: 'Immigration officer or information desk staff',
        setting: `${city} airport arrivals, passport control, baggage claim`,
        key: ['State purpose/duration', 'Collect luggage', 'Choose transport (Metro/train/taxi)'],
        goal: 'Clear passport control and pick a route into the city'
      },
      food: {
        id: 'food-1',
        title: 'Café Like a Local',
        brief: `Order confidently and fix small mistakes politely.`,
        role: 'Barista or waiter',
        setting: 'Busy café counter; limited time to order',
        key: ['Drink + one item', '“Para tomar / para llevar”', 'If wrong, correct kindly'],
        goal: 'Place a clear order and handle any correction'
      },
      daily: {
        id: 'daily-1',
        title: 'New Flat, New Roommate',
        brief: 'Introduce yourself and agree on three basic house norms.',
        role: 'Roommate',
        setting: 'Shared flat common area',
        key: ['Cleanliness', 'Noise hours', 'Guests'],
        goal: 'Introduce yourself and agree 3 simple rules'
      },
      culture: {
        id: 'culture-1',
        title: 'Colloquialisms & Flamenco',
        brief: 'Learn a few Madrid expressions and plan a tablao visit.',
        role: 'Local friend',
        setting: 'City center café after work',
        key: ['3 expressions', 'What is a tablao', 'Pick date/place'],
        goal: 'Understand expressions and choose a tablao show'
      },
      social: {
        id: 'social-1',
        title: 'Meet & Make Plans',
        brief: 'Set a concrete day, time, and place with someone new.',
        role: 'New acquaintance',
        setting: 'Public square outside a Metro stop',
        key: ['Confirm time/place', 'Exchange contact', 'Agree plan'],
        goal: 'Schedule a short meet-up without ambiguity'
      }
    };
    return map[tab];
  }

  function nextScenario(prev, idx) {
    // Simple progression template that builds difficulty
    const level = levelSel.value;
    const city = citySel.value;
    const bump = idx + 1;
    const templates = {
      travel: [
        { title: 'Lost Luggage', role: 'Baggage office staff', setting: `${city} airport lost & found`,
          key: ['File a claim', 'Provide address', 'Get case number'],
          goal: 'Open a claim and set delivery window'
        },
        { title: 'Metro Directions', role: 'Metro information agent', setting: `${city} Metro station`,
          key: ['Confirm correct line', 'Transfers', 'Exit near destination'],
          goal: 'Confirm a clear route door-to-door'
        }
      ],
      food: [
        { title: 'Fix a Wrong Order', role: 'Waiter', setting: 'Café table service',
          key: ['Point out mistake', 'Suggest fix', 'Stay polite'],
          goal: 'Correct the order without friction'
        },
        { title: 'Recommendations', role: 'Local friend', setting: 'Neighborhood bar',
          key: ['Ask favorite dish', 'Try 2–3 classics', 'Pick a drink'],
          goal: 'Choose 2–3 dishes and a drink'
        }
      ],
      daily: [
        { title: 'Buy a Phone Plan', role: 'Shop assistant', setting: 'Mobile carrier shop',
          key: ['Prepaid vs contract', 'Data minutes', 'Activation'],
          goal: 'Choose and activate a SIM plan'
        },
        { title: 'Buy a Small Appliance', role: 'Store clerk', setting: 'Electronics store',
          key: ['Compare options', 'Warranty', 'Delivery'],
          goal: 'Pick a suitable model and pay'
        }
      ],
      culture: [
        { title: 'Buy Tablao Tickets', role: 'Box office staff', setting: 'Tablao venue',
          key: ['Seats/visibility', 'Show time', 'Arrival time'],
          goal: 'Buy tickets and plan arrival'
        },
        { title: 'Discuss Differences', role: 'Local friend', setting: 'Walk through city center',
          key: ['Schedules', 'Forms of address', 'Social norms'],
          goal: 'Compare differences with examples'
        }
      ],
      social: [
        { title: 'Meet the Group', role: 'Friend’s group', setting: 'Plaza or small bar',
          key: ['Introduce yourself', 'Light topics', 'Plan next meet'],
          goal: 'Integrate with the group naturally'
        },
        { title: 'Join a Rec League', role: 'Team captain', setting: 'Local pitch',
          key: ['Position/level', 'Schedule', 'Equipment'],
          goal: 'Confirm participation and role'
        }
      ]
    };
    const pool = templates[prev.category] || [];
    const t = pool[(bump - 1) % pool.length];
    return {
      id: `${prev.category}-${prev.index + 1}`,
      index: prev.index + 1,
      category: prev.category,
      title: t.title,
      brief: t.title + ' — progressive follow-up.',
      role: t.role,
      setting: t.setting,
      key: t.key,
      goal: t.goal
    };
  }

  // In-memory + persisted lists
  const defaultLists = ['travel','food','daily','culture','social'].reduce((acc, cat) => {
    acc[cat] = [ wrapInitial(initialScenario(cat), cat) ];
    return acc;
  }, { custom: [] });

  function wrapInitial(obj, category) {
    return { ...obj, category, index: 1 };
  }

  let lists = loadLists();

  function loadLists() {
    try {
      const raw = localStorage.getItem(STORE.listsKey);
      if (!raw) return structuredClone(defaultLists);
      const parsed = JSON.parse(raw);
      // If city changed since first load, refresh first items’ briefs to reflect city
      return { ...structuredClone(defaultLists), ...parsed };
    } catch {
      return structuredClone(defaultLists);
    }
  }
  function saveLists() {
    localStorage.setItem(STORE.listsKey, JSON.stringify(lists));
  }

  // ------------------------------------------------------------
  // Rendering
  // ------------------------------------------------------------
  const containers = {
    travel:  document.getElementById('list-travel'),
    food:    document.getElementById('list-food'),
    daily:   document.getElementById('list-daily'),
    culture: document.getElementById('list-culture'),
    social:  document.getElementById('list-social'),
    custom:  document.getElementById('list-custom')
  };

  function renderAll() {
    ['travel','food','daily','culture','social','custom'].forEach(renderCategory);
  }

  function renderCategory(category) {
    const root = containers[category];
    if (!root) return;
    root.innerHTML = '';
    const arr = lists[category] || [];
    arr.forEach(item => {
      root.appendChild(renderSceneCard(item));
    });
  }

  function renderSceneCard(scn) {
    const el = document.createElement('article');
    el.className = 'card scene-card';
    el.innerHTML = `
      <div class="content">
        <h4>${scn.title}</h4>
        <p>${scn.brief}</p>
        <div class="actions" style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;">
          <button class="button ghost" data-act="details" data-id="${scn.id}" data-cat="${scn.category}">Details</button>
        </div>
      </div>
    `;
    return el;
  }

  // Rebuild first scene descriptions when city changes
  citySel.addEventListener('change', () => {
    ['travel','food','daily','culture','social'].forEach(cat => {
      if (lists[cat] && lists[cat][0]) {
        lists[cat][0] = wrapInitial(initialScenario(cat), cat);
      }
    });
    saveLists(); renderAll();
  });

  // ------------------------------------------------------------
  // Tabs
  // ------------------------------------------------------------
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById('panel-' + btn.dataset.tab).classList.add('active');
    });
  });

  // ------------------------------------------------------------
  // Modal behaviors
  // ------------------------------------------------------------
  const modal = document.getElementById('modal');
  const closeModalBtn = document.getElementById('closeModal');
  const modalTitle = document.getElementById('modalTitle');
  const modalRole = document.getElementById('modalRole');
  const modalSetting = document.getElementById('modalSetting');
  const modalKey = document.getElementById('modalKey');
  const copyBtn = document.getElementById('copyPrompt');
  const completeBtn = document.getElementById('markComplete');

  let current = null;

  function openModal(scn) {
    current = scn;
    modalTitle.textContent = scn.title;
    modalRole.textContent = scn.role;
    modalSetting.textContent = scn.setting;
    modalKey.innerHTML = Array.isArray(scn.key) ? `<ul style="margin:0 0 0 18px;">${scn.key.map(k=>`<li>${k}</li>`).join('')}</ul>` : scn.key || '';
    modal.classList.add('open');
  }
  function closeModal(){ modal.classList.remove('open'); current = null; }
  closeModalBtn.addEventListener('click', closeModal);
  modal.addEventListener('click', (e)=>{ if(e.target === modal) closeModal(); });

  // Listen for Details buttons
  document.getElementById('scenes').addEventListener('click', (e) => {
    const btn = e.target.closest('button[data-act="details"]');
    if (!btn) return;
    const cat = btn.getAttribute('data-cat');
    const id  = btn.getAttribute('data-id');
    const scn = (lists[cat] || []).find(s => s.id === id);
    if (scn) openModal(scn);
  });

  // Copy prompt
  copyBtn.addEventListener('click', async () => {
    if (!current) return;
    const text = buildPrompt(current);
    try {
      await navigator.clipboard.writeText(text);
      copyBtn.textContent = 'Copied!';
      setTimeout(()=> copyBtn.textContent = 'Copy Prompt', 900);
    } catch {
      // fallback
      const t = document.createElement('textarea');
      t.value = text; document.body.appendChild(t); t.select();
      document.execCommand('copy'); document.body.removeChild(t);
    }
  });

  // Mark complete → append a follow-up underneath in same tab
  completeBtn.addEventListener('click', () => {
    if (!current) return;
    const cat = current.category;
    const idx = current.index || 1;
    const next = nextScenario(current, idx);
    // Ensure unique id
    next.id = `${cat}-${Date.now()}-${Math.random().toString(36).slice(2,7)}`;
    lists[cat].push(next);
    saveLists();
    renderCategory(cat);
    closeModal();
  });

  // ------------------------------------------------------------
  // Custom scenarios
  // ------------------------------------------------------------
  document.getElementById('addCustom').addEventListener('click', () => {
    const kw = (document.getElementById('customKeyword').value || '').trim();
    if (!kw) { alert('Please enter a keyword.'); return; }
    const city = citySel.value;
    const scn = {
      id: `custom-${Date.now()}`,
      index: (lists.custom?.length || 0) + 1,
      category: 'custom',
      title: `Custom: ${capitalize(kw)}`,
      brief: `Practice focused on “${kw}” in ${city}.`,
      role: 'A helpful local in the right context for your topic',
      setting: `Realistic ${city} setting related to "${kw}"`,
      key: ['Define your goal clearly', 'Ask relevant questions', 'Summarize outcome'],
      goal: `Make progress on "${kw}" in a natural conversation`
    };
    lists.custom = lists.custom || [];
    lists.custom.push(scn);
    saveLists(); renderCategory('custom');
    document.getElementById('customKeyword').value = '';
  });

  // ------------------------------------------------------------
  // Prompt builder (used for Copy)
  // ------------------------------------------------------------
  function buildPrompt(scn) {
    const lang  = langSel.value;    // Spanish | English
    const city  = citySel.value;    // e.g., Madrid
    const level = levelSel.value;   // A1..C2

    // Keep prompt short; model will expand
    return [
      `Language: ${lang}. City: ${city}. CEFR level: ${level}.`,
      `Role-play a short, realistic conversation. I am the learner.`,
      `Scenario: ${scn.title}.`,
      `You are: ${scn.role}. Setting: ${scn.setting}.`,
      scn.goal ? `Goal: ${scn.goal}.` : '',
      Array.isArray(scn.key) && scn.key.length ? `Key points: ${scn.key.join('; ')}.` : '',
      `Style: natural ${lang === 'Spanish' ? 'Spanish' : 'English'} (${level}); 1–2 sentence turns.`,
      `Correct briefly when helpful. Ask questions to keep it moving.`,
      `End when the goal is clearly achieved, then give 3–5 tips.`,
    ].filter(Boolean).join('\n');
  }

  // ------------------------------------------------------------
  // Helpers
  // ------------------------------------------------------------
  function capitalize(s){ return s.charAt(0).toUpperCase() + s.slice(1); }

  // Initial render
  renderAll();

  // TODO: AI INTEGRATION
  // When you’re ready, replace modal + alert flows with a chat UI that calls your backend/SDK.
  // You’ll use { language, city, level, scenario } to seed the conversation.
</script>
</body>
</html>
